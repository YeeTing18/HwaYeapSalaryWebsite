<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8B0000;
            --primary-dark: #4B0000;
            --secondary: #A52A2A;
            --accent: #FFD700;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
            --success: #2e7d32;
            --danger: #8B0000;
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 70px;
        }
        
        body {
            background-color: #f5f7fb;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--dark-text);
            overflow-x: hidden;
            transition: all 0.3s;
        }
        
        /* Sidebar Styling */
        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 3px 0 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar-collapsed #sidebar {
            width: var(--sidebar-collapsed-width);
        }
        
        .sidebar-header {
            padding: 25px 20px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .sidebar-collapsed .sidebar-header {
            padding: 25px 15px;
        }
        
        .sidebar-header h3 {
            font-weight: 600;
            margin: 0;
            font-size: 1.4rem;
            display: inline-block;
            transition: opacity 0.3s;
        }
        
        .sidebar-collapsed .sidebar-header h3 {
            opacity: 0;
            width: 0;
        }
        
        .sidebar-header img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            display: inline-block;
            vertical-align: middle;
        }
        
        .nav-link {
            color: rgba(255,255,255,0.8);
            padding: 15px 20px;
            margin: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s;
            white-space: nowrap;
            overflow: hidden;
        }
        
        .sidebar-collapsed .nav-link {
            padding: 15px;
            text-align: center;
        }
        
        .nav-link:hover, .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.1);
        }
        
        .nav-link i {
            width: 25px;
            text-align: center;
            margin-right: 10px;
            font-size: 1.2rem;
            vertical-align: middle;
        }
        
        .sidebar-collapsed .nav-link i {
            margin-right: 0;
            font-size: 1.4rem;
        }
        
        .nav-link span {
            vertical-align: middle;
        }
        
        .sidebar-collapsed .nav-link span {
            display: none;
        }
        
        /* Main Content */
        #content {
            padding: 20px;
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            transition: all 0.3s;
        }
        
        .sidebar-collapsed #content {
            margin-left: var(--sidebar-collapsed-width);
            width: calc(100% - var(--sidebar-collapsed-width));
        }
        
        .page-header {
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .toggle-sidebar {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .toggle-sidebar:hover {
            background: var(--secondary);
        }
        
        .card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: white;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 15px 20px;
            border-radius: 12px 12px 0 0 !important;
            font-weight: 600;
        }
        
        /* Salary Voucher Styling */
        .voucher-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .voucher-header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .voucher-header h2 {
            font-size: 1.8rem;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .voucher-header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, var(--accent), #ffab00);
        }
        
        .employee-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 25px;
            background-color: #f5f5f5;
            border-bottom: 2px dashed #e0e0e0;
        }
        
        .info-group {
            margin-bottom: 10px;
        }
        
        .info-label {
            font-weight: 600;
            color: #37474f;
            display: inline-block;
            width: 120px;
        }
        
        .salary-period {
            background-color: #FFF0F0;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 1px solid #FFD6D6;
        }
        
        .details-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }
        
        .earnings, .deductions {
            padding: 25px;
        }
        
        .deductions {
            background-color: #fff8e1;
            border-left: 1px solid #ffecb3;
        }
        
        .section-title {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #CD5C5C;
            font-size: 1.2rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .detail-label {
            color: #455a64;
        }
        
        .detail-value {
            font-weight: 600;
            color: #263238;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 10px;
        }
        
        .gross-total {
            color: var(--success);
            border-top: 2px solid #81c784;
        }
        
        .deductions-total {
            color: var(--danger);
            border-top: 2px solid #CD5C5C;
        }
        
        .net-pay {
            padding: 25px;
            background-color: #FFF0F0;
            border-top: 2px solid #FFD6D6;
            border-bottom: 2px dashed #e0e0e0;
        }
        
        .net-pay-row {
            display: flex;
            justify-content: space-between;
            font-size: 1.4rem;
            font-weight: 700;
            color: #8B0000;
        }
        
        .employer-contributions {
            padding: 25px;
            background-color: #FFF0F0;
        }
        
        .contributions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .contribution-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.05);
        }
        
        .signature-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 25px;
            background-color: #f5f5f5;
            border-top: 2px dashed #e0e0e0;
        }
        
        .signature-group {
            text-align: center;
        }
        
        .signature-label {
            font-weight: 600;
            color: #455a64;
            margin-bottom: 10px;
        }
        
        .signature-box {
            height: 80px;
            border: 1px dashed #bdbdbd;
            border-radius: 5px;
            margin: 0 auto;
            width: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            color: #9e9e9e;
            font-style: italic;
        }
        
        /* Employee Management */
        .employee-form {
            padding: 25px;
        }
        
        .employee-table {
            padding: 20px;
        }
        
        .table th {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--secondary), var(--primary));
        }
        
        .action-btns .btn {
            padding: 5px 10px;
            margin: 0 3px;
        }
        
        /* Watermark */
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem;
            color: rgba(139, 0, 0, 0.05);
            font-weight: 900;
            pointer-events: none;
            z-index: 0;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            #sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar-collapsed #sidebar {
                transform: translateX(0);
                width: var(--sidebar-collapsed-width);
            }
            
            #content {
                margin-left: 0;
                width: 100%;
            }
            
            .sidebar-collapsed #content {
                margin-left: var(--sidebar-collapsed-width);
                width: calc(100% - var(--sidebar-collapsed-width));
            }
        }
        
        @media (max-width: 768px) {
            .details-section {
                grid-template-columns: 1fr;
            }
            
            .deductions {
                border-left: none;
                border-top: 1px solid #ffecb3;
            }
            
            .voucher-header h2 {
                font-size: 1.4rem;
            }
            
            .salary-period {
                font-size: 1rem;
            }
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        /* Add these styles to your existing CSS */
        .salary-period-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .salary-period-selector .form-select {
            width: auto;
            min-width: 120px;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--primary);
            font-weight: 500;
        }

        .salary-period-selector .form-select:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
        }
      /* Responsive */
      @media (max-width: 992px) {
            #sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar-collapsed #sidebar {
                transform: translateX(0);
                width: var(--sidebar-collapsed-width);
            }
            
            #content {
                margin-left: 0;
                width: 100%;
            }
            
            .sidebar-collapsed #content {
                margin-left: var(--sidebar-collapsed-width);
                width: calc(100% - var(--sidebar-collapsed-width));
            }
        }
        
        @media (max-width: 768px) {
            .details-section {
                grid-template-columns: 1fr;
            }
            
            .deductions {
                border-left: none;
                border-top: 1px solid #ffecb3;
            }
            
            .voucher-header h2 {
                font-size: 1.4rem;
            }
            
            .salary-period {
                font-size: 1rem;
            }
        }
        @media print {
            /* Reset all colors to black and white */
            * {
                color: black !important;
                background-color: white !important;
                box-shadow: none !important;
                text-shadow: none !important;
            }

            /* Hide elements not needed for printing */
            .toggle-sidebar,
            .salary-period-selector,
            .action-buttons,
            #sidebar,
            .btn-group,
            .save-section,
            .salary-period,
            .page-header,
            .row.mb-4 {
                display: none !important;
            }

            /* Adjust layout for printing */
            #content {
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
            }

            /* Style the voucher for printing */
            .voucher-container {
                box-shadow: none !important;
                border: 1px solid #000 !important;
                display: flex !important;
                flex-direction: column !important;
                font-size: 8pt !important;
            }

            .voucher-header {
                background: white !important;
                border-bottom: 2px solid #000 !important;
                padding: 5px !important;
                width: 100% !important;
            }

            .voucher-header h2 {
                color: black !important;
                font-size: 12pt !important;
                margin: 0 !important;
            }

            /* Style employee info to be on one line */
            .employee-info {
                display: flex !important;
                justify-content: space-between !important;
                padding: 3px 10px !important;
                background: white !important;
                border-bottom: 1px solid #000 !important;
                width: 100% !important;
                font-size: 8pt !important;
            }

            .info-group {
                margin: 0 !important;
                display: inline-block !important;
            }

            /* Create two-column layout for main content */
            .main-content {
                display: flex !important;
                width: 100% !important;
            }

            .left-column {
                width: 55% !important;
                border-right: 1px solid #000 !important;
                padding-right: 5px !important;
            }

            .right-column {
                width: 45% !important;
                padding-left: 5px !important;
            }

            .details-section,
            .additions-section,
            .net-pay {
                width: 100% !important;
            }

            .earnings, .deductions {
                background: white !important;
                border: 1px solid #000 !important;
                padding: 5px !important;
            }

            .section-title {
                color: black !important;
                border-bottom: 1px solid #000 !important;
                font-size: 9pt !important;
                margin: 3px 0 !important;
                padding-bottom: 3px !important;
            }

            .detail-row {
                border-bottom: 1px solid #000 !important;
                padding: 2px 0 !important;
                font-size: 8pt !important;
                display: flex !important;
                justify-content: space-between !important;
            }

            .total-row {
                border-top: 1px solid #000 !important;
                padding: 3px 0 !important;
                font-size: 9pt !important;
                display: flex !important;
                justify-content: space-between !important;
            }

            .gross-total, .deductions-total {
                color: black !important;
            }

            .net-pay {
                background: white !important;
                border: 1px solid #000 !important;
                padding: 5px !important;
            }

            .net-pay-row {
                color: black !important;
                font-size: 9pt !important;
                display: flex !important;
                justify-content: space-between !important;
            }

            .employer-contributions {
                background: white !important;
                padding: 5px !important;
            }

            .contribution-item {
                background: white !important;
                border: 1px solid #000 !important;
                margin-bottom: 5px !important;
                padding: 3px !important;
                font-size: 8pt !important;
            }

            .contribution-label {
                font-size: 8pt !important;
            }

            .contribution-value {
                font-size: 8pt !important;
            }

            .signature-section {
                background: white !important;
                border-top: 1px solid #000 !important;
                padding: 5px !important;
            }

            .signature-box {
                border: 1px solid #000 !important;
                height: 40px !important;
                margin-bottom: 10px !important;
            }

            .signature-label {
                font-size: 8pt !important;
                margin-bottom: 3px !important;
            }

            /* Adjust font sizes for better print readability */
            body {
                font-size: 8pt !important;
            }

            h1, h2, h3 {
                font-size: 10pt !important;
            }

            .detail-label, .detail-value {
                font-size: 8pt !important;
            }

            /* Ensure all borders are visible */
            .card, .voucher-container, .section-title, .detail-row, .total-row {
                border-color: #000 !important;
            }

            /* Remove any gradients */
            .voucher-header, .btn-primary, .nav-link {
                background: white !important;
            }

            /* Ensure text is readable */
            .info-label, .detail-label, .signature-label {
                color: black !important;
            }

            /* Remove any decorative elements */
            .watermark {
                display: none !important;
            }

            /* Hide overtime calculation details in print */
            .overtime-details {
                display: none !important;
                visibility: hidden !important;
            }

            .overtime-entry {
                display: block !important;
                text-align: right !important;
            }

            .overtime-amount {
                display: inline-block !important;
                text-align: right !important;
            }

            /* Ensure other detail rows maintain their layout */
            .earnings .detail-row:not(.overtime-entry),
            .deductions .detail-row,
            .additions-section .detail-row {
                display: flex !important;
                justify-content: space-between !important;
            }

            .earnings .detail-row:not(.overtime-entry) span:first-child,
            .deductions .detail-row span:first-child,
            .additions-section .detail-row span:first-child {
                display: inline-block !important;
            }

            .salary-calculations {
                background: white !important;
                border-bottom: 1px solid #000 !important;
                padding: 5px 10px !important;
                margin: 0 !important;
            }

            .calculations-grid {
                display: flex !important;
                justify-content: space-between !important;
                gap: 10px !important;
                margin: 0 !important;
            }

            .calculation-item {
                background: white !important;
                border: 1px solid #000 !important;
                padding: 3px 8px !important;
                flex: 1 !important;
                text-align: center !important;
                min-width: 0 !important;
            }

            .calculation-label {
                font-size: 7pt !important;
                margin-bottom: 2px !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }

            .calculation-value {
                font-size: 8pt !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }

            .salary-calculations .section-title {
                font-size: 8pt !important;
                margin: 0 0 5px 0 !important;
                padding: 0 !important;
                border: none !important;
            }
        }

        /* Add Salary Calculations Styles */
        .salary-calculations {
            padding: 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .calculations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .calculation-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .calculation-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .calculation-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
        }

        @media print {
            .salary-calculations {
                background: white !important;
                border-bottom: 1px solid #000 !important;
                padding: 10px !important;
            }

            .calculation-item {
                background: white !important;
                border: 1px solid #000 !important;
                padding: 5px !important;
            }

            .calculation-label {
                font-size: 8pt !important;
            }

            .calculation-value {
                font-size: 9pt !important;
            }
        }

        @media print {
            /* Employee Print Styles */
            .employee-print .salary-calculations {
                display: none !important;
            }

            .employee-print .overtime-details {
                display: none !important;
            }

            .employee-print .overtime-entry {
                display: block !important;
                text-align: right !important;
            }

            .employee-print .overtime-amount {
                display: inline-block !important;
                text-align: right !important;
            }

            /* Admin Print Styles */
            .admin-print .salary-calculations {
                display: block !important;
            }

            .admin-print .overtime-details {
                display: inline-block !important;
            }

            .admin-print .overtime-entry {
                display: flex !important;
                justify-content: space-between !important;
            }

            .admin-print .overtime-amount {
                display: inline-block !important;
            }
        }
        
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="sidebar-header">
                <img src="HwaYeapLogo.jpg" alt="Logo">
                <h3>Salary System</h3>
            </div>
            <ul class="nav flex-column mt-4">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-page="voucher">
                        <i class="fas fa-file-invoice-dollar"></i> <span>Employee Salary Voucher</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="internSalaryVoucher.html" data-page="intern-voucher">
                        <i class="fas fa-file-invoice-dollar"></i> <span>InternSalary Voucher</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="employeePage.html" data-page="employees">
                        <i class="fas fa-users"></i> <span>Employee Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="monthlySalary.html">
                        <i class="fas fa-chart-line"></i> <span>Monthly Salary Record</span>
                    </a>
                </li>
                <!-- <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="fas fa-cog"></i> <span>Settings</span>
                    </a>
                </li> -->
                <li class="nav-item mt-4">
                    <a class="nav-link" href="#">
                        <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div id="content">
            <button class="toggle-sidebar">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- Salary Voucher Page -->
            <div id="voucher-page" class="page active">
                <div class="page-header">
                    <h1 class="h3 mb-0">Employee Salary Voucher</h1>
                    <p class="mb-0">View and manage employee salary details</p>
                </div>
                
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>Employee Salary Details</div>
                                <!-- <div class="action-buttons">
                                    <button class="btn btn-success" onclick="saveAsExcel()">
                                        <i class="fas fa-file-excel"></i> Save as Excel
                                    </button>
                                    <button class="btn btn-danger" onclick="printForEmployee()">
                                        <i class="fas fa-file-pdf"></i> Print For Employee
                                    </button>
                                    <button class="btn btn-primary" onclick="printForAdmin()">
                                        <i class="fas fa-print"></i> Print For Admin
                                    </button>
                                </div> -->
                            </div>
                            <div class="card-body">
                                <div class="voucher-container">
                                    <div class="watermark"></div>
                                    
                                    <div class="voucher-header">
                                        <h2>SALARY VOUCHER 薪金传票</h2>
                                        <div class="salary-period-selector">
                                            <select class="form-select" id="salaryMonth" style="width: 120px; display: inline-block;">
                                                <option value="">Select Month</option>
                                                <option value="January">January</option>
                                                <option value="February">February</option>
                                                <option value="March">March</option>
                                                <option value="April">April</option>
                                                <option value="May">May</option>
                                                <option value="June">June</option>
                                                <option value="July">July</option>
                                                <option value="August">August</option>
                                                <option value="September">September</option>
                                                <option value="October">October</option>
                                                <option value="November">November</option>
                                                <option value="December">December</option>
                                            </select>
                                            <input type="number" class="form-control" id="salaryYear" placeholder="Year" style="width: 100px;" min="2000" max="2100">
                                            
                                            <!-- Add new section for retrieving old data -->
                                            <div class="retrieve-old-data" style="display: inline-block; margin-left: 15px; padding-left: 15px; border-left: 1px solid rgba(255,255,255,0.3);">
                                                <span style="color: white; margin-right: 10px;">Retrieve from:</span>
                                                <select class="form-select" id="retrieveMonth" style="width: 120px; display: inline-block;">
                                                    <option value="">Select Month</option>
                                                    <option value="January">January</option>
                                                    <option value="February">February</option>
                                                    <option value="March">March</option>
                                                    <option value="April">April</option>
                                                    <option value="May">May</option>
                                                    <option value="June">June</option>
                                                    <option value="July">July</option>
                                                    <option value="August">August</option>
                                                    <option value="September">September</option>
                                                    <option value="October">October</option>
                                                    <option value="November">November</option>
                                                    <option value="December">December</option>
                                                </select>
                                                <input type="number" class="form-control" id="retrieveYear" placeholder="Year" style="width: 100px; display: inline-block;" min="2000" max="2100">
                                                <button class="btn btn-light btn-sm" onclick="retrieveOldData()" style="margin-left: 10px;">
                                                    <i class="fas fa-history"></i> Retrieve
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="employee-info">
                                        <div class="info-group">
                                            <span class="info-label">PAY TO:</span>
                                            <select class="form-select" id="employeeSelect" style="width: 200px; display: inline-block;">
                                                <option value="">Select Employee</option>
                                            </select>
                                        </div>
                                        <div class="info-group">
                                            <span class="info-label">I/C NO:</span>
                                            <span class="info-value" id="icNumber">-</span>
                                        </div>
                                        <div class="info-group">
                                            <span class="info-label">BANK ACC:</span>
                                            <span class="info-value" id="bankAccount">-</span>
                                        </div>
                                    </div>
                                    
                                    <div class="salary-calculations" style="background-color: #FFF0F0; padding: 15px 25px; border-bottom: 1px solid #FFD6D6;">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="calculation-item">
                                                    <div class="calculation-label" style="font-weight: 600; color: var(--primary);">日薪 SALARY PER DAYS</div>
                                                    <div class="calculation-formula" style="font-size: 0.9rem; color: #666;">(BASIC/45/4*9)</div>
                                                    <div class="calculation-value" id="dailySalary" style="font-weight: 600; color: var(--primary);">RM 0.00</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="calculation-item">
                                                    <div class="calculation-label" style="font-weight: 600; color: var(--primary);">时薪 SALARY PER HOURS</div>
                                                    <div class="calculation-formula" style="font-size: 0.9rem; color: #666;">(BASIC/45/4)</div>
                                                    <div class="calculation-value" id="hourlySalary" style="font-weight: 600; color: var(--primary);">RM 0.00</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="calculation-item">
                                                    <div class="calculation-label" style="font-weight: 600; color: var(--primary);">OT-1.5</div>
                                                    <div class="calculation-formula" style="font-size: 0.9rem; color: #666;">(Hours*1.5)</div>
                                                    <div class="calculation-value" id="ot1_5" style="font-weight: 600; color: var(--primary);">RM 0.00</div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="calculation-item">
                                                    <div class="calculation-label" style="font-weight: 600; color: var(--primary);">OT-2.0</div>
                                                    <div class="calculation-formula" style="font-size: 0.9rem; color: #666;">(Hours*2.0)</div>
                                                    <div class="calculation-value" id="ot2_0" style="font-weight: 600; color: var(--primary);">RM 0.00</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="salary-period">
                                        Salary For April 2025
                                    </div>
                                    
                                    <div class="details-section">
                                        <div class="earnings">
                                            <h3 class="section-title">Earnings</h3>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">BASIC PAY 基本支付 epf</span>
                                                <span class="detail-value" id="basicPay">RM 0.00</span>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">OVERTIME 超时</span>
                                                <div class="overtime-inputs" style="display: flex; gap: 10px; align-items: center;">
                                                    <input type="number" class="form-control form-control-sm" id="otHours" style="width: 80px;" min="0" step="0.5" placeholder="Hours">
                                                    <select class="form-select form-select-sm" id="otMultiplier" style="width: 100px;">
                                                        <option value="1.5">1.5x</option>
                                                        <option value="2.0">2.0x</option>
                                                    </select>
                                                    <button class="btn btn-sm btn-outline-primary" id="addOvertime">
                                                        <i class="fas fa-plus"></i> Add
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="overtimeList" style="margin-left: 20px; margin-top: 10px;">
                                                <!-- Overtime entries will be added here -->
                                            </div>
                                            <div class="detail-row" id="totalOvertimeRow" style="display: none;">
                                                <span class="detail-label">Total Overtime</span>
                                                <span class="detail-value" id="totalOvertime">RM 0.00</span>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">TRAVEL ALLOWANCES 津贴</span>
                                                <span class="detail-value" id="allowances">RM 0.00</span>
                                            </div>
                                            
                                            <div class="total-row gross-total">
                                                <span>(A) GROSS PAY 总付额</span>
                                                <span id="grossPayAmount">RM 0.00</span>
                                            </div>
                                        </div>
                                        
                                        <div class="deductions">
                                            <h3 class="section-title">Deductions</h3>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">EPF - EMPLOYEE 雇员公积金</span>
                                                <div class="input-group input-group-sm" style="width: 200px;">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="epfEmployee" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">SOCSO 社会保险金</span>
                                                <div class="input-group input-group-sm" style="width: 200px;">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="socso" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">EIS 就业保险金</span>
                                                <div class="input-group input-group-sm" style="width: 200px;">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="eis" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">INCOME TAX (PCB) 所得税</span>
                                                <div class="input-group input-group-sm" style="width: 200px;">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="pcb" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">ADVANCE / LOAN 预支/贷款</span>
                                                <div class="input-group" style="width: 300px;">
                                                    <select class="form-select" id="advanceLoanType" style="width: 40%;">
                                                        <option value="Cash">Cash</option>
                                                        <option value="BankIn">BankIn</option>
                                                    </select>
                                                    <span class="input-group-text" style="width: 20%;">RM</span>
                                                    <input type="number" class="form-control" id="advanceLoan" value="0.00" step="0.01" style="width: 40%;">
                                                 
                                                </div>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">DAILY DEDUCTION 每日扣除</span>
                                                <div class="input-group input-group-sm" style="width: 200px;">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="dailyDeduction" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">HOURS DEDUCTION 小时扣除</span>
                                                <div class="input-group input-group-sm" style="width: 200px;">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="hoursDeduction" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="detail-row">
                                                <span class="detail-label">ALLOWANCE DEDUCTIONS</span>
                                                <div class="input-group input-group-sm" style="width: 200px;">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="allowanceDeductions" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="total-row deductions-total">
                                                <span>(B) TOTAL DEDUCTIONS 总扣除额</span>
                                                <span id="totalDeductions">RM 0.00</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="additions-section" style="background-color: #FFF0F0; padding: 25px; border-top: 2px solid #FFD6D6; border-bottom: 2px dashed #e0e0e0;">
                                        <h3 class="section-title">附加 ADDITIONS</h3>
                                        <div class="additions-list" id="additionsList">
                                            <!-- Addition entries will be added here -->
                                        </div>
                                        <div class="addition-inputs" style="margin-top: 15px;">
                                            <div class="row">
                                                <div class="col-md-5">
                                                    <select class="form-control" id="additionName">
                                                        <option value="">Select or Enter Addition</option>
                                                        <option value="Singapore Travelling Allowance">Singapore Travelling Allowance</option>
                                                        <option value="Housing Subsidy">Housing Subsidy</option>
                                                        <option value="Performance Bonus">Performance Bonus</option>
                                                        <option value="Other">Other (Enter Below)</option>
                                                    </select>
                                                    <input type="text" class="form-control mt-2" id="customAddition" placeholder="Enter custom addition name" style="display: none;">
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="input-group">
                                                        <span class="input-group-text">RM</span>
                                                        <input type="number" class="form-control" id="additionAmount" min="0" step="0.01" placeholder="0.00">
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <button class="btn btn-primary" id="addAddition">
                                                        <i class="fas fa-plus"></i> Add
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="total-row" style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #CD5C5C;">
                                            <span>(C) TOTAL ADDITIONS 总附加额</span>
                                            <span id="totalAdditions">RM 0.00</span>
                                        </div>
                                    </div>
                                    
                                    <div class="net-pay">
                                        <div class="net-pay-row">
                                            <span>NET PAY (A-B+C) 净付额</span>
                                            <span id="netPayAmount">RM 0.00</span>
                                        </div>
                                    </div>
                                    
                                    <div class="employer-contributions">
                                        <h3 class="section-title">Employer Contributions</h3>
                                        
                                        <div class="contributions-grid">
                                            <div class="contribution-item">
                                                <div class="contribution-label">EMPLOYER'S EPF 雇主公积金</div>
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="employerEpf" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="contribution-item">
                                                <div class="contribution-label">EMPLOYER'S SOCSO 社会保险金</div>
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="employerSocso" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="contribution-item">
                                                <div class="contribution-label">EMPLOYER'S EIS 就业保险金</div>
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-text">RM</span>
                                                    <input type="number" class="form-control" id="employerEis" min="0" step="0.01" value="0.00">
                                                </div>
                                            </div>
                                            
                                            <div class="contribution-item">
                                                <div class="contribution-label">TOTAL CONTRIBUTION 总补贴</div>
                                                <div class="contribution-value" id="totalEmployerContribution">RM 0.00</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="signature-section">
                                        <div class="signature-group">
                                            <div class="signature-label">APPROVED BY 批准者</div>
                                            <div class="signature-box">Chong</div>
                                        </div>
                                        
                                        <div class="signature-group">
                                            <div class="signature-label">EMPLOYEES SIGNATURE 雇员签名</div>
                                            <div class="signature-box">BankIn</div>
                                        </div>
                                        
                                        <div class="signature-group">
                                            <div class="signature-label">Company Stamp</div>
                                            <div class="signature-box"></div>
                    </div>
                </div>
            </div>
            
                                <div class="save-section" style="padding: 20px; text-align: center; background-color: #FFF0F0; border-top: 2px solid #FFD6D6;">
                                    <button class="btn btn-primary btn-lg" id="saveSalary" style="min-width: 200px;">
                                        <i class="fas fa-save"></i> Save Salary Record
                                        </button>
                                    </div>
                            </div>
                        </div>
                    </div>
                                </div>
                                </div>
                                
            <footer>
                <p>Salary Management System &copy; 2025 - This is a computer-generated document</p>
            </footer>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Add Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
        import { getDatabase, ref, get, onValue, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAEdrpzI8RsyuN7LrlGvWVF6FaMmfIcADU",
            authDomain: "hwayeap-1db99.firebaseapp.com",
            databaseURL: "https://hwayeap-1db99-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "hwayeap-1db99",
            storageBucket: "hwayeap-1db99.firebasestorage.app",
            messagingSenderId: "393592107948",
            appId: "1:393592107948:web:fa2031eb8f5f0cf4b04009",
            measurementId: "G-35S9W4P3TS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        // Make Firebase functions available globally
        window.database = database;
        window.ref = ref;
        window.get = get;
        window.onValue = onValue;
        window.set = set;
    </script>
    <script>
        // Toggle sidebar
        document.querySelector('.toggle-sidebar').addEventListener('click', function() {
            document.body.classList.toggle('sidebar-collapsed');
            
            // Save state to localStorage
            if (document.body.classList.contains('sidebar-collapsed')) {
                localStorage.setItem('sidebarState', 'collapsed');
            } else {
                localStorage.setItem('sidebarState', 'expanded');
            }
        });
        
        // Check localStorage for sidebar state
        if (localStorage.getItem('sidebarState') === 'collapsed') {
            document.body.classList.add('sidebar-collapsed');
        }
        
        // Page navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                // Only prevent default for links without href
                if (!this.getAttribute('href')) {
                e.preventDefault();
                }
                
                // Remove active class from all links
                document.querySelectorAll('.nav-link').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // Show the target page
                const pageId = this.getAttribute('data-page');
                if(pageId) {
                    document.getElementById(`${pageId}-page`).classList.add('active');
                }
            });
        });
        
        // Set current month and year when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const currentDate = new Date();
            const currentMonth = currentDate.toLocaleString('default', { month: 'long' });
            const currentYear = currentDate.getFullYear().toString();

           // document.getElementById('salaryMonth').value = currentMonth;
            document.getElementById('salaryYear').value = currentYear;
            
            // Add input validation for month
            document.getElementById('salaryMonth').addEventListener('input', function(e) {
                const month = e.target.value.toLowerCase();
                const validMonths = ['january', 'february', 'march', 'april', 'may', 'june', 
                                   'july', 'august', 'september', 'october', 'november', 'december'];
                if (!validMonths.includes(month)) {
                    e.target.setCustomValidity('Please enter a valid month');
                } else {
                    e.target.setCustomValidity('');
                }
            });
            
            // Load employees into dropdown
            loadEmployees();
        });

        // Load employees into dropdown
        function loadEmployees() {
            const employeeSelect = document.getElementById('employeeSelect');
            const employeesRef = ref(database, 'Employee');

            onValue(employeesRef, (snapshot) => {
                // Clear existing options except the first one
                while (employeeSelect.options.length > 1) {
                    employeeSelect.remove(1);
                }

                snapshot.forEach((childSnapshot) => {
                    const employeeName = childSnapshot.key;
                    const employeeData = childSnapshot.val();
                    
                    // Only add employees (not interns) to the dropdown
                    if (employeeData.position === 'Employee') {
                        const option = document.createElement('option');
                        option.value = employeeName;
                        option.textContent = employeeName;
                        employeeSelect.appendChild(option);
                    }
                });
            }, (error) => {
                console.error("Error loading employees: ", error);
                alert("Error loading employees. Please try again.");
            });
        }

        // Function to format number without rounding
        function formatNumber(num) {
            return num.toFixed(2).replace(/\.?0+$/, '');
        }

        // Add event listener for employee selection
        document.getElementById('employeeSelect').addEventListener('change', function(e) {
            const selectedEmployee = e.target.value;
            if (selectedEmployee) {
                // Load employee details
                const employeeRef = ref(database, `Employee/${selectedEmployee}`);
                get(employeeRef).then((snapshot) => {
                    if (snapshot.exists()) {
                        const employeeData = snapshot.val();
                        console.log('Employee Data:', employeeData); // Debug log
                        
                        try {
                            // Update employee details with null checks
                            document.getElementById('icNumber').textContent = employeeData.icNumber || '-';
                            document.getElementById('bankAccount').textContent = employeeData.bankAccount || '-';
                            
                            // Update signature box with bank account
                            document.querySelector('.signature-group:nth-child(2) .signature-box').textContent = 
                                employeeData.bankAccount || '-';
                            
                            // Safely convert and validate basicPay
                            let basicPay = 0;
                            if (employeeData.basicPay !== undefined && employeeData.basicPay !== null) {
                                basicPay = Number(employeeData.basicPay);
                                if (isNaN(basicPay)) basicPay = 0;
                            }
                            document.getElementById('basicPay').textContent = `RM ${formatNumber(basicPay)}`;
                            
                            // Safely convert and validate allowances
                            let allowances = 0;
                            if (employeeData.allowances !== undefined && employeeData.allowances !== null) {
                                allowances = Number(employeeData.allowances);
                                if (isNaN(allowances)) allowances = 0;
                            }
                            document.getElementById('allowances').textContent = `RM ${formatNumber(allowances)}`;
                            
                            // Calculate daily salary (BASIC/45/4*9)
                            const dailySalary = (basicPay / 45 / 4 * 9);
                            document.getElementById('dailySalary').textContent = `RM ${formatNumber(dailySalary)}`;
                            
                            // Calculate hourly salary (BASIC/45/4) without rounding
                            const hourlySalary = (basicPay / 45 / 4);
                            document.getElementById('hourlySalary').textContent = `RM ${formatNumber(hourlySalary)}`;
                            
                            // Set hourly rate for overtime calculations
                            window.currentHourlyRate = hourlySalary;
                            
                            // Update overtime rates
                            document.getElementById('ot1_5').textContent = `RM ${formatNumber(hourlySalary * 1.5)}`;
                            document.getElementById('ot2_0').textContent = `RM ${formatNumber(hourlySalary * 2.0)}`;
                            
                            // Clear employer contribution fields
                            document.getElementById('employerEpf').value = '';
                            document.getElementById('employerSocso').value = '';
                            document.getElementById('employerEis').value = '';
                            document.getElementById('totalEmployerContribution').textContent = 'RM 0.00';
                            
                            // Update gross pay
                            updateGrossPay();
                        } catch (error) {
                            console.error("Error processing employee data:", error);
                            alert("Error processing employee data. Please check the console for details.");
                        }
                    } else {
                        console.log('No employee data found for:', selectedEmployee);
                        resetEmployeeFields();
                    }
                }).catch((error) => {
                    console.error("Error loading employee details:", error);
                    alert("Error loading employee details. Please try again.");
                    resetEmployeeFields();
                });
            } else {
                resetEmployeeFields();
            }
        });

        // Helper function to reset employee fields
        function resetEmployeeFields() {
            document.getElementById('icNumber').textContent = '-';
            document.getElementById('bankAccount').textContent = '-';
            document.querySelector('.signature-group:nth-child(2) .signature-box').textContent = '-';
            document.getElementById('basicPay').textContent = 'RM 0.00';
            document.getElementById('allowances').textContent = 'RM 0.00';
            document.getElementById('dailySalary').textContent = 'RM 0.00';
            document.getElementById('hourlySalary').textContent = 'RM 0.00';
            document.getElementById('ot1_5').textContent = 'RM 0.00';
            document.getElementById('ot2_0').textContent = 'RM 0.00';
            document.getElementById('employerEpf').value = '';
            document.getElementById('employerSocso').value = '';
            document.getElementById('employerEis').value = '';
            document.getElementById('totalEmployerContribution').textContent = 'RM 0.00';
            window.currentHourlyRate = 0;
            updateGrossPay();
        }

        // Handle additions
        let additionsEntries = [];

        // Add event listener for addition name selection
        document.getElementById('additionName').addEventListener('change', function() {
            const customAdditionInput = document.getElementById('customAddition');
            if (this.value === 'Other') {
                customAdditionInput.style.display = 'block';
                customAdditionInput.focus();
            } else {
                customAdditionInput.style.display = 'none';
                customAdditionInput.value = '';
            }
        });

        // Update addAddition event listener
        document.getElementById('addAddition').addEventListener('click', function() {
            let name = document.getElementById('additionName').value;
            const customAddition = document.getElementById('customAddition').value.trim();
            const amount = parseFloat(document.getElementById('additionAmount').value);
            
            // If "Other" is selected, use the custom input value
            if (name === 'Other') {
                name = customAddition;
            }
            
            if (!name) {
                alert('Please enter addition name');
                return;
            }

            if (isNaN(amount) || amount <= 0) {
                alert('Please enter valid amount');
                return;
            }

            additionsEntries.push({ name, amount });

            // Add to list
            const entry = document.createElement('div');
            entry.className = 'addition-entry';
            entry.style.marginBottom = '10px';
            entry.innerHTML = `
                <div class="row">
                    <div class="col-md-5">
                        <span class="detail-label">${name}</span>
                    </div>
                    <div class="col-md-4">
                        <span class="detail-value">RM ${amount.toFixed(2)}</span>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-sm btn-outline-danger" onclick="removeAddition(${additionsEntries.length - 1})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('additionsList').appendChild(entry);

            // Update total
            updateTotalAdditions();

            // Clear inputs
            document.getElementById('additionName').value = '';
            document.getElementById('customAddition').value = '';
            document.getElementById('customAddition').style.display = 'none';
            document.getElementById('additionAmount').value = '';
        });

        // Function to remove addition entry
        window.removeAddition = function(index) {
            additionsEntries.splice(index, 1);
            document.getElementById('additionsList').innerHTML = '';
            
            // Recreate list
            additionsEntries.forEach((entry, i) => {
                const entryElement = document.createElement('div');
                entryElement.className = 'addition-entry';
                entryElement.style.marginBottom = '10px';
                entryElement.innerHTML = `
                    <div class="row">
                        <div class="col-md-5">
                            <span class="detail-label">${entry.name}</span>
                        </div>
                        <div class="col-md-4">
                            <span class="detail-value">RM ${entry.amount.toFixed(2)}</span>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-sm btn-outline-danger" onclick="removeAddition(${i})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('additionsList').appendChild(entryElement);
            });

            updateTotalAdditions();
        };

        // Function to update total additions
        function updateTotalAdditions() {
            const total = additionsEntries.reduce((sum, entry) => sum + entry.amount, 0);
            document.getElementById('totalAdditions').textContent = `RM ${formatNumber(total)}`;
            updateNetPay();
        }

        // Save salary record
        function saveSalaryRecord() {
            const employee = document.getElementById('employeeSelect').value;
            if (!employee) {
                alert('Please select an employee first');
                return;
            }

            const month = document.getElementById('salaryMonth').value;
            const year = document.getElementById('salaryYear').value;

            // Validate month and year
            if (!month || !year) {
                alert('Please enter both month and year');
                return;
            }

            // Validate month format
            const validMonths = ['january', 'february', 'march', 'april', 'may', 'june', 
                               'july', 'august', 'september', 'october', 'november', 'december'];
            if (!validMonths.includes(month.toLowerCase())) {
                alert('Please enter a valid month');
                return;
            }

            // Validate year format
            if (!/^\d{4}$/.test(year)) {
                alert('Please enter a valid year (YYYY)');
                return;
            }

            // Get all the salary data
            const salaryData = {
                basicPay: parseFloat(document.getElementById('basicPay').textContent.replace('RM ', '')) || 0,
                allowances: parseFloat(document.getElementById('allowances').textContent.replace('RM ', '')) || 0,
                grossPay: parseFloat(document.getElementById('grossPayAmount').textContent.replace('RM ', '')) || 0,
                // Add salary calculations
                salaryCalculations: {
                    dailySalary: parseFloat(document.getElementById('dailySalary').textContent.replace('RM ', '')) || 0,
                    hourlySalary: parseFloat(document.getElementById('hourlySalary').textContent.replace('RM ', '')) || 0,
                    ot1_5Rate: parseFloat(document.getElementById('ot1_5').textContent.replace('RM ', '')) || 0,
                    ot2_0Rate: parseFloat(document.getElementById('ot2_0').textContent.replace('RM ', '')) || 0
                },
                deductions: {
                    epfEmployee: parseFloat(document.getElementById('epfEmployee').value) || 0,
                    socso: parseFloat(document.getElementById('socso').value) || 0,
                    eis: parseFloat(document.getElementById('eis').value) || 0,
                    pcb: parseFloat(document.getElementById('pcb').value) || 0,
                    advanceLoan: parseFloat(document.getElementById('advanceLoan').value) || 0,
                    advanceLoanType: document.getElementById('advanceLoanType').value,
                    dailyDeduction: parseFloat(document.getElementById('dailyDeduction').value) || 0,
                    hoursDeduction: parseFloat(document.getElementById('hoursDeduction').value) || 0,
                    allowanceDeductions: parseFloat(document.getElementById('allowanceDeductions').value) || 0,
                    totalDeductions: parseFloat(document.getElementById('totalDeductions').textContent.replace('RM ', '')) || 0
                },
                additions: additionsEntries.map(entry => ({
                    name: entry.name,
                    amount: parseFloat(entry.amount)
                })),
                totalAdditions: parseFloat(document.getElementById('totalAdditions').textContent.replace('RM ', '')) || 0,
                netPay: parseFloat(document.getElementById('netPayAmount').textContent.replace('RM ', '')) || 0,
                employerContributions: {
                    epf: parseFloat(document.getElementById('employerEpf').value) || 0,
                    socso: parseFloat(document.getElementById('employerSocso').value) || 0,
                    eis: parseFloat(document.getElementById('employerEis').value) || 0,
                    total: parseFloat(document.getElementById('totalEmployerContribution').textContent.replace('RM ', '')) || 0
                },
                overtime: overtimeEntries,
                timestamp: new Date().toISOString()
            };

            // Save to Firebase
            const salaryRef = ref(database, `Salary/${year}/${month}/${employee}`);
            set(salaryRef, salaryData)
                .then(() => {
                    alert('Salary record saved successfully!');
                })
                .catch((error) => {
                    console.error("Error saving salary record: ", error);
                    alert("Error saving salary record. Please try again.");
                });
        }

        // Add event listener for save button
        document.getElementById('saveSalary').addEventListener('click', saveSalaryRecord);

        // Handle overtime calculations
        let overtimeEntries = [];

        document.getElementById('addOvertime').addEventListener('click', function() {
            const hours = parseFloat(document.getElementById('otHours').value);
            const multiplier = parseFloat(document.getElementById('otMultiplier').value);
            
            if (isNaN(hours) || hours <= 0) {
                alert('Please enter valid hours');
                return;
            }

            if (!window.currentHourlyRate) {
                alert('Please select an employee first');
                return;
            }

            const overtimeAmount = (hours * window.currentHourlyRate * multiplier).toFixed(2);
            overtimeEntries.push({ hours, multiplier, amount: overtimeAmount });

            // Add to list
            const entry = document.createElement('div');
            entry.className = 'overtime-entry';
            entry.style.marginBottom = '5px';
            entry.innerHTML = `
                <span class="overtime-hours">${hours}</span>
                <span class="overtime-multiplier">${multiplier}</span>
                <span class="overtime-amount">RM ${overtimeAmount}</span>
                <button class="btn btn-sm btn-outline-danger ms-2" onclick="removeOvertime(${overtimeEntries.length - 1})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            document.getElementById('overtimeList').appendChild(entry);

            // Update total
            updateOvertimeTotal();

            // Clear inputs
            document.getElementById('otHours').value = '';
        });

        // Function to update overtime total
        function updateOvertimeTotal() {
            const total = overtimeEntries.reduce((sum, entry) => sum + parseFloat(entry.amount), 0);
            document.getElementById('totalOvertime').textContent = `RM ${formatNumber(total)}`;
            document.getElementById('totalOvertimeRow').style.display = total > 0 ? 'flex' : 'none';
            updateGrossPay(); // Update gross pay when overtime changes
        }

        // Function to remove overtime entry
        window.removeOvertime = function(index) {
            overtimeEntries.splice(index, 1);
            document.getElementById('overtimeList').innerHTML = '';
            
            // Recreate list
            overtimeEntries.forEach((entry, i) => {
                const entryElement = document.createElement('div');
                entryElement.className = 'overtime-entry';
                entryElement.style.marginBottom = '5px';
                entryElement.innerHTML = `
                    <span class="overtime-hours">${entry.hours}</span>
                    <span class="overtime-multiplier">${entry.multiplier}</span>
                    <span class="overtime-amount">RM ${entry.amount}</span>
                    <button class="btn btn-sm btn-outline-danger ms-2" onclick="removeOvertime(${i})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                document.getElementById('overtimeList').appendChild(entryElement);
            });

            updateOvertimeTotal(); // This will also update gross pay
        };

        // Function to update gross pay
        function updateGrossPay() {
            const basicPay = parseFloat(document.getElementById('basicPay').textContent.replace('RM ', '')) || 0;
            const overtimeTotal = parseFloat(document.getElementById('totalOvertime').textContent.replace('RM ', '')) || 0;
            const allowances = parseFloat(document.getElementById('allowances').textContent.replace('RM ', '')) || 0;
            
            const grossPay = basicPay + overtimeTotal + allowances;
            document.getElementById('grossPayAmount').textContent = `RM ${formatNumber(grossPay)}`;
            updateNetPay(); // Update net pay when gross pay changes
        }

        // Add event listeners for deduction inputs
        const deductionInputs = [
            'epfEmployee', 'socso', 'eis', 'pcb', 'advanceLoan',
            'dailyDeduction', 'hoursDeduction', 'allowanceDeductions'
        ];

        deductionInputs.forEach(id => {
            document.getElementById(id).addEventListener('input', updateTotalDeductions);
        });

        // Function to update total deductions
        function updateTotalDeductions() {
            const total = deductionInputs.reduce((sum, id) => {
                const value = parseFloat(document.getElementById(id).value) || 0;
                return sum + value;
            }, 0);
            
            document.getElementById('totalDeductions').textContent = `RM ${formatNumber(total)}`;
            updateNetPay();
        }

        // Update net pay function to use A-B+C formula
        function updateNetPay() {
            // A = Gross Pay (Basic Pay + Overtime + Allowances)
            const basicPay = parseFloat(document.getElementById('basicPay').textContent.replace('RM ', '')) || 0;
            const overtimeTotal = parseFloat(document.getElementById('totalOvertime').textContent.replace('RM ', '')) || 0;
            const allowances = parseFloat(document.getElementById('allowances').textContent.replace('RM ', '')) || 0;
            const grossPay = basicPay + overtimeTotal + allowances;

            // B = Total Deductions
            const totalDeductions = parseFloat(document.getElementById('totalDeductions').textContent.replace('RM ', '')) || 0;

            // C = Total Additions
            const totalAdditions = additionsEntries.reduce((sum, entry) => sum + entry.amount, 0);

            // Net Pay = A - B + C
            const netPay = grossPay - totalDeductions + totalAdditions;
            document.getElementById('netPayAmount').textContent = `RM ${formatNumber(netPay)}`;
        }

        // Update gross pay when employee changes
        document.getElementById('employeeSelect').addEventListener('change', function(e) {
            if (!e.target.value) {
                // Reset fields if no employee is selected
                document.getElementById('icNumber').textContent = '-';
                document.getElementById('bankAccount').textContent = '-';
                document.getElementById('basicPay').textContent = 'RM 0.00';
                document.getElementById('allowances').textContent = 'RM 0.00';
                document.getElementById('dailySalary').textContent = 'RM 0.00';
                document.getElementById('hourlySalary').textContent = 'RM 0.00';
                document.getElementById('ot1_5').textContent = 'RM 0.00';
                document.getElementById('ot2_0').textContent = 'RM 0.00';
                // Clear overtime list
                document.getElementById('overtimeList').innerHTML = '';
                document.getElementById('totalOvertimeRow').style.display = 'none';
                document.getElementById('totalOvertime').textContent = 'RM 0.00';
                window.currentHourlyRate = 0;
                // Update gross pay
                updateGrossPay();
            }
        });

        // Add event listeners for employer contribution inputs
        document.getElementById('employerEpf').addEventListener('input', updateTotalEmployerContribution);
        document.getElementById('employerSocso').addEventListener('input', updateTotalEmployerContribution);
        document.getElementById('employerEis').addEventListener('input', updateTotalEmployerContribution);

        // Function to update total employer contribution
        function updateTotalEmployerContribution() {
            const employerEpf = parseFloat(document.getElementById('employerEpf').value) || 0;
            const employerSocso = parseFloat(document.getElementById('employerSocso').value) || 0;
            const employerEis = parseFloat(document.getElementById('employerEis').value) || 0;
            
            const totalContribution = employerEpf + employerSocso + employerEis;
            document.getElementById('totalEmployerContribution').textContent = `RM ${formatNumber(totalContribution)}`;
        }

        // Add event listeners for all input changes
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for deduction inputs
            deductionInputs.forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    updateTotalDeductions();
                    updateNetPay();
                });
            });

            // Add event listeners for employer contribution inputs
            ['employerEpf', 'employerSocso', 'employerEis'].forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    updateTotalEmployerContribution();
                });
            });

            // Add event listener for overtime changes
            document.getElementById('addOvertime').addEventListener('click', function() {
                updateOvertimeTotal();
                updateGrossPay();
            });

            // Add event listener for addition changes
            document.getElementById('addAddition').addEventListener('click', function() {
                updateTotalAdditions();
                updateNetPay();
            });

            // Add event listener for employee selection
            document.getElementById('employeeSelect').addEventListener('change', function() {
                updateGrossPay();
                updateNetPay();
            });
        });

        // Print Functions
        function printForEmployee() {
            // Add employee print class to body
            document.body.classList.add('employee-print');
            // Remove admin print class if it exists
            document.body.classList.remove('admin-print');
            // Print
            window.print();
            // Remove the class after printing
            setTimeout(() => {
                document.body.classList.remove('employee-print');
            }, 1000);
        }

        function printForAdmin() {
            // Add admin print class to body
            document.body.classList.add('admin-print');
            // Remove employee print class if it exists
            document.body.classList.remove('employee-print');
            // Print
            window.print();
            // Remove the class after printing
            setTimeout(() => {
                document.body.classList.remove('admin-print');
            }, 1000);
        }

        // Add print styles
        const style = document.createElement('style');
        style.textContent = `
            @media print {
                /* Reset all colors to black and white */
                * {
                    color: black !important;
                    background-color: white !important;
                    box-shadow: none !important;
                    text-shadow: none !important;
                }

                /* Hide elements not needed for printing */
                .toggle-sidebar,
                .salary-period-selector,
                .action-buttons,
                #sidebar,
                .btn-group,
                .save-section {
                    display: none !important;
                }

                /* Adjust layout for printing */
                #content {
                    margin: 0 !important;
                    padding: 0 !important;
                    width: 100% !important;
                }

                /* Style the voucher for printing */
                .voucher-container {
                    box-shadow: none !important;
                    border: 1px solid #000 !important;
                }

                .voucher-header {
                    background: white !important;
                    border-bottom: 2px solid #000 !important;
                }

                .voucher-header h2 {
                    color: black !important;
                }

                .employee-info {
                    background: white !important;
                    border-bottom: 1px solid #000 !important;
                }

                .salary-calculations {
                    background: white !important;
                    border-bottom: 1px solid #000 !important;
                }

                .salary-period {
                    background: white !important;
                    border-bottom: 1px solid #000 !important;
                }

                .earnings, .deductions {
                    background: white !important;
                    border: 1px solid #000 !important;
                }

                .section-title {
                    color: black !important;
                    border-bottom: 1px solid #000 !important;
                }

                .detail-row {
                    border-bottom: 1px solid #000 !important;
                }

                .total-row {
                    border-top: 2px solid #000 !important;
                }

                .gross-total, .deductions-total {
                    color: black !important;
                }

                .net-pay {
                    background: white !important;
                    border: 1px solid #000 !important;
                }

                .net-pay-row {
                    color: black !important;
                }

                .employer-contributions {
                    background: white !important;
                }

                .contribution-item {
                    background: white !important;
                    border: 1px solid #000 !important;
                }

                .signature-section {
                    background: white !important;
                    border-top: 1px solid #000 !important;
                }

                .signature-box {
                    border: 1px solid #000 !important;
                }

                /* Employee Print Styles */
                .employee-print .salary-calculations {
                    display: none !important;
                }

                .employee-print .overtime-details {
                    display: none !important;
                }

                .employee-print .overtime-entry {
                    display: block !important;
                    text-align: right !important;
                }

                .employee-print .overtime-amount {
                    display: inline-block !important;
                    text-align: right !important;
                }

                /* Admin Print Styles */
                .admin-print .salary-calculations {
                    display: block !important;
                }

                .admin-print .overtime-details {
                    display: inline-block !important;
                }

                .admin-print .overtime-entry {
                    display: flex !important;
                    justify-content: space-between !important;
                }

                .admin-print .overtime-amount {
                    display: inline-block !important;
                }

                /* Adjust font sizes for better print readability */
                body {
                    font-size: 12pt !important;
                }

                h1, h2, h3 {
                    font-size: 14pt !important;
                }

                .detail-label, .detail-value {
                    font-size: 11pt !important;
                }

                /* Ensure all borders are visible */
                .card, .voucher-container, .section-title, .detail-row, .total-row {
                    border-color: #000 !important;
                }

                /* Remove any gradients */
                .voucher-header, .btn-primary, .nav-link {
                    background: white !important;
                }

                /* Ensure text is readable */
                .info-label, .detail-label, .signature-label {
                    color: black !important;
                }

                /* Remove any decorative elements */
                .watermark {
                    display: none !important;
                }
            }
        `;
        document.head.appendChild(style);

        // Add function to retrieve old salary data
        function retrieveOldData() {
            const employee = document.getElementById('employeeSelect').value;
            if (!employee) {
                alert('Please select an employee first');
                return;
            }

            const retrieveMonth = document.getElementById('retrieveMonth').value;
            const retrieveYear = document.getElementById('retrieveYear').value;

            if (!retrieveMonth || !retrieveYear) {
                alert('Please select both month and year to retrieve data');
                return;
            }

            // Get salary data from Firebase
            const salaryRef = ref(database, `Salary/${retrieveYear}/${retrieveMonth}/${employee}`);
            get(salaryRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const salaryData = snapshot.val();
                    
                    // Update UI with retrieved data
                    // Basic Pay and Allowances
                    document.getElementById('basicPay').textContent = `RM ${formatNumber(salaryData.basicPay)}`;
                    document.getElementById('allowances').textContent = `RM ${formatNumber(salaryData.allowances)}`;
                    
                    // Deductions
                    document.getElementById('epfEmployee').value = salaryData.deductions.epfEmployee;
                    document.getElementById('socso').value = salaryData.deductions.socso;
                    document.getElementById('eis').value = salaryData.deductions.eis;
                    document.getElementById('pcb').value = salaryData.deductions.pcb;
                    document.getElementById('advanceLoan').value = salaryData.deductions.advanceLoan;
                    document.getElementById('advanceLoanType').value = salaryData.deductions.advanceLoanType;
                    document.getElementById('dailyDeduction').value = salaryData.deductions.dailyDeduction;
                    document.getElementById('hoursDeduction').value = salaryData.deductions.hoursDeduction;
                    document.getElementById('allowanceDeductions').value = salaryData.deductions.allowanceDeductions;
                    
                    // Employer Contributions
                    document.getElementById('employerEpf').value = salaryData.employerContributions.epf;
                    document.getElementById('employerSocso').value = salaryData.employerContributions.socso;
                    document.getElementById('employerEis').value = salaryData.employerContributions.eis;
                    
                    // Clear and update overtime entries
                    overtimeEntries = salaryData.overtime || [];
                    document.getElementById('overtimeList').innerHTML = '';
                    overtimeEntries.forEach((entry, i) => {
                        const entryElement = document.createElement('div');
                        entryElement.className = 'overtime-entry';
                        entryElement.style.marginBottom = '5px';
                        entryElement.innerHTML = `
                            <span class="overtime-hours">${entry.hours}</span>
                            <span class="overtime-multiplier">${entry.multiplier}</span>
                            <span class="overtime-amount">RM ${entry.amount}</span>
                            <button class="btn btn-sm btn-outline-danger ms-2" onclick="removeOvertime(${i})">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        document.getElementById('overtimeList').appendChild(entryElement);
                    });
                    
                    // Clear and update additions
                    additionsEntries = salaryData.additions || [];
                    document.getElementById('additionsList').innerHTML = '';
                    additionsEntries.forEach((entry, i) => {
                        const entryElement = document.createElement('div');
                        entryElement.className = 'addition-entry';
                        entryElement.style.marginBottom = '10px';
                        entryElement.innerHTML = `
                            <div class="row">
                                <div class="col-md-5">
                                    <span class="detail-label">${entry.name}</span>
                                </div>
                                <div class="col-md-4">
                                    <span class="detail-value">RM ${entry.amount.toFixed(2)}</span>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-sm btn-outline-danger" onclick="removeAddition(${i})">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        document.getElementById('additionsList').appendChild(entryElement);
                    });
                    
                    // Update all totals
                    updateOvertimeTotal();
                    updateTotalDeductions();
                    updateTotalAdditions();
                    updateTotalEmployerContribution();
                    updateGrossPay();
                    updateNetPay();
                    
                    alert('Data retrieved successfully! You can now modify and save as a new record.');
                } else {
                    alert('No salary record found for the selected period');
                }
            }).catch((error) => {
                console.error("Error retrieving salary data: ", error);
                alert("Error retrieving salary data. Please try again.");
            });
        }
    </script>
</body>
</html>